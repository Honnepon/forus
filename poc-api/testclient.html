<!doctype html>
<html>
    <head>
        <title>WS test</title>
    </head>
    <body>

        <label>
            Server address:
            <input type="text" id="serveraddress" value="ws://localhost:8484/"/>
        </label>

        <hr/>
        
        <button onclick="createAccount()">create new account</button>

        <hr/>

        <div>Import existing account:</div>
        <label>
            Private key:
            <input type="text" id="privatekey"/>
        </label>
        <br/>
        <button onclick="addAccount()">Add</button>

        <hr/>

        <div>New account address: <span id="newaddress"></span></div>

        <hr/>

        <label>
            My address:
            <input type="text" id="myaddress" value=""/>
        </label>

        <hr/>

        <div>Balance: <span id="balance"></span> (wei)</div>
        <button onclick="getBalance()">Get balance</button>

        <hr/>

        <div>Send ether:</div>
        <label>
            To:
            <input type="text" id="sendto"/>
        </label>
        <br/>
        <label>
            Amount:
            <input type="number" id="amount"/> (wei)
        </label>
        <div>Transaction result: <span id="trxres"></span></div>
        <br/>
        <button onclick="sendEther()">Send</button>

        <hr/>

        <div>Deploy ERC20 token:</div>
        <label>
            name:
            <input type="text" id="tokenname"/>
        </label>
        <br/>
        <label>
            Total supply:
            <input type="number" id="totalsupply"/>
        </label>
        <div>Token address: <span id="createerc20trxres"></span></div>
        <br/>
        <button onclick="deployToken()">Deploy</button>

        <hr/>

        <label>
            Token address:
            <input type="text" id="tokenaddress" value=""/>
        </label>

        <hr/>

        <div>Name: <span id="tokenname"></span></div>
        <button onclick="getTokenName()">Get name</button>

        <hr/>

        <div>Total supply: <span id="totalsupply"></span></div>
        <button onclick="getTokenTotalSupply()">Get total supply</button>

        <hr/>

        <label>
            Owner address:
            <input type="text" id="tokenOwnerAddress"/>
        </label>

        <hr/>

        <div>Owner balance: <span id="ownerbalance"></span></div>
        <button onclick="getTokenBalanceOf()">Get balance</button>

        <hr/>

        <div>Deploy identity:</div>
        <div>Token address: <span id="createidentitytrxres"></span></div>
        <br/>
        <button onclick="deployIdentity()">Deploy</button>

        <hr/>

        <label>
            Identity address:
            <input type="text" id="identityaddress" value=""/>
        </label>

        <hr/>

        <div>Set identity attribute:</div>
        <label>
            Name:
            <input type="text" id="setattributename" value=""/>
        </label>
        <br/>
        <label>
            Value:
            <input type="text" id="setattributevalue" value=""/>
        </label>
        <div>Result: <span id="setidentityattributetrxres"></span></div>
        <br/>
        <button onclick="setIdentityAttribute()">Set</button>

        <hr/>

        <div>Validate identity attribute:</div>
        <label>
            Name:
            <input type="text" id="validateattributename" value=""/>
        </label>
        <br/>
        <label>
            Validator address:
            <input type="text" id="validateattributevalidator" value=""/>
        </label>
        <div>Result: <span id="validateidentityattributetrxres"></span></div>
        <br/>
        <button onclick="validateIdentityAttribute()">Validate</button>

        <hr/>

        <div>Get identity attribute:</div>
        <label>
            Name:
            <input type="text" id="getattributename" value=""/>
        </label>
        <div>Result: <span id="getidentityattributetrxres"></span></div>
        <br/>
        <button onclick="getIdentityAttribute()">Get</button>

        <hr/>

        <div>Set IPFS attribute:</div>
        <label>
            Name:
            <input type="text" id="setipfsattributename" value=""/>
        </label>
        <br/>
        <label>
            Value:
            <input type="text" id="setipfsattributevalue" value=""/>
        </label>
        <div>Result: <span id="setipfsattributetrxres"></span></div>
        <br/>
        <button onclick="setIPFSAttribute()">Set</button>

        <hr/>

        <div>Get IPFS attribute:</div>
        <label>
            Name:
            <input type="text" id="getipfsattributename" value=""/>
        </label>
        <div>Result: <span id="getipfsattributetrxres"></span></div>
        <br/>
        <button onclick="getIPFSAttribute()">Get</button>

        <hr/>

        <div>Get IPFS path:</div>
        <div>Result: <span id="getipfspathtrxres"></span></div>
        <br/>
        <button onclick="getIPFSPath()">Get</button>




        

        <script type="text/javascript">
            var ws = new WebSocket(document.getElementById("serveraddress").value);

            ws.onopen = function()
            {
                console.log("Connection is open..."); 
            };

            ws.onmessage = function (balance) 
            {
                const event = JSON.parse(balance.data);
                switch (event.eventName) {
                    case 'balance':
                        document.getElementById("balance").innerText = event.eventData.balance;
                        break;
                    case 'receipt':
                        document.getElementById("trxres").innerText = 'Transaction mined in block: ' + event.eventData.receipt.blockNumber;
                        break;
                    case 'newAccount':
                        document.getElementById("newaddress").innerText = event.eventData.address;
                        break;
                    case 'tokenDeployed':
                        document.getElementById("createerc20trxres").innerText = event.eventData.address;
                        break;
                    case 'identityDeployed':
                        document.getElementById("createidentitytrxres").innerText = event.eventData.address;
                        break;
                    case 'identityAttributeChanged':
                        document.getElementById("setidentityattributetrxres").innerText = 
                        event.eventData.identityAddress + '.' +
                        event.eventData.attributeName + ' = ' +
                        event.eventData.attributeValue;
                        break;
                    case 'identityAttributeValidated':
                        document.getElementById("validateidentityattributetrxres").innerText = 
                        event.eventData.identityAddress + '.' +
                        event.eventData.attributeName + ' is validated by:  ' +
                        event.eventData.validatorAddress;
                        break;
                    case 'identityAttribute':
                        document.getElementById("getidentityattributetrxres").innerText = 
                        event.eventData.identityAddress + '.' +
                        event.eventData.attributeName + ' = { ' +
                        'name: ' + event.eventData.attribute.name +
                        ', value: ' + event.eventData.attribute.value +
                        ', validator: ' + event.eventData.attribute.validator + ' }';
                        break;
                    case 'ipfsAttributeChanged':
                        document.getElementById("setipfsattributetrxres").innerText = 
                        event.eventData.identityAddress + '.' +
                        event.eventData.attributeName + ' = ' +
                        event.eventData.attributeValue;
                        break;
                    case 'ipfsAttribute':
                        document.getElementById("getipfsattributetrxres").innerText = 
                        event.eventData.identityAddress + '.' +
                        event.eventData.attributeName + ' = ' +
                        event.eventData.attributeValue;
                        break;
                    case 'ipfsPath':
                        document.getElementById("getipfspathtrxres").innerText = 
                        event.eventData.path
                        break;
                }
            };
             
            ws.onclose = function()
            { 
               console.log("Connection is closed..."); 
            };

            getBalance = function() {
                const event = JSON.stringify({
                    eventName: 'getBalance',
                    eventData: {
                        address: document.getElementById("myaddress").value
                    }
                });

                ws.send(event);
            };

            sendEther = function() {
                document.getElementById("trxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'sendEther',
                    eventData: {
                        from: document.getElementById("myaddress").value,
                        to: document.getElementById("sendto").value,
                        amount: document.getElementById("amount").value,
                    }
                });

                ws.send(event);
            };
            
            addAccount = function() {
                document.getElementById("newaddress").innerText = '';

                const event = JSON.stringify({
                    eventName: 'addAccount',
                    eventData: {
                        privateKey: document.getElementById("privatekey").value
                    }
                });

                ws.send(event);
            };

            createAccount = function() {
                document.getElementById("newaddress").innerText = '';

                const event = JSON.stringify({
                    eventName: 'createAccount'
                });

                ws.send(event);
            };

            deployToken = function() {
                document.getElementById("createerc20trxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'deployToken',
                    eventData: {
                        creatorAddress: document.getElementById("myaddress").value,
                        tokenName: document.getElementById("tokenname").value,
                        totalSupply: document.getElementById("totalsupply").value
                    }
                });

                ws.send(event);
            };

            getTokenName = function() {
                const event = JSON.stringify({
                    eventName: 'getTokenName',
                    eventData: {
                        address: document.getElementById("tokenaddress").value
                    }
                });

                ws.send(event);
            };

            getTokenTotalSupply = function() {
                const event = JSON.stringify({
                    eventName: 'getTokenTotalSupply',
                    eventData: {
                        address: document.getElementById("tokenaddress").value
                    }
                });

                ws.send(event);
            };

            getTokenBalanceOf = function() {
                const event = JSON.stringify({
                    eventName: 'getTokenBalanceOf',
                    eventData: {
                        tokenAddress: document.getElementById("tokenaddress").value,
                        ownerAddress: document.getElementById("tokenOwnerAddress").value
                    }
                });

                ws.send(event);
            };

            deployIdentity = function() {
                document.getElementById("createidentitytrxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'deployIdentity',
                    eventData: {
                        creatorAddress: document.getElementById("myaddress").value
                    }
                });

                ws.send(event);
            };

            setIdentityAttribute = function() {
                document.getElementById("setidentityattributetrxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'setIdentityAttribute',
                    eventData: {
                        ownerAddress: document.getElementById("myaddress").value,
                        identityAddress: document.getElementById("identityaddress").value,
                        attributeName: document.getElementById("setattributename").value,
                        attributeValue: document.getElementById("setattributevalue").value
                    }
                });

                ws.send(event);
            };

            validateIdentityAttribute = function() {
                document.getElementById("validateidentityattributetrxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'validateIdentityAttribute',
                    eventData: {
                        ownerAddress: document.getElementById("myaddress").value,
                        identityAddress: document.getElementById("identityaddress").value,
                        attributeName: document.getElementById("validateattributename").value,
                        validatorAddress: document.getElementById("validateattributevalidator").value
                    }
                });

                ws.send(event);
            };

            getIdentityAttribute = function() {
                document.getElementById("getidentityattributetrxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'getIdentityAttribute',
                    eventData: {
                        identityAddress: document.getElementById("identityaddress").value,
                        attributeName: document.getElementById("getattributename").value,
                    }
                });

                ws.send(event);
            };

            setIPFSAttribute = function() {
                document.getElementById("setipfsattributetrxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'setIPFSAttribute',
                    eventData: {
                        ownerAddress: document.getElementById("myaddress").value,
                        identityAddress: document.getElementById("identityaddress").value,
                        attributeName: document.getElementById("setipfsattributename").value,
                        attributeValue: document.getElementById("setipfsattributevalue").value
                    }
                });

                ws.send(event);
            };

            getIPFSAttribute = function() {
                document.getElementById("getipfsattributetrxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'getIPFSAttribute',
                    eventData: {
                        ownerAddress: document.getElementById("myaddress").value,
                        identityAddress: document.getElementById("identityaddress").value,
                        attributeName: document.getElementById("getipfsattributename").value,
                    }
                });

                ws.send(event);
            };

            getIPFSPath = function() {
                document.getElementById("getipfspathtrxres").innerText = '';

                const event = JSON.stringify({
                    eventName: 'getIPFSPath',
                    eventData: {
                        identityAddress: document.getElementById("identityaddress").value
                    }
                });

                ws.send(event);
            };

        </script>
    </body>
</html>
